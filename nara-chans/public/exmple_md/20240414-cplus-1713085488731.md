---
title: C++学習①晩御飯決定アプリを作って基本学習
category: cplus
description: c++とシェルスクリプトの練習のために、cloud9を使って晩御飯決定アプリを作成
date: 20240414
---

# C++学習①晩御飯決定アプリを作って基本学習


## はじめに
  次のプロジェクトが、C++とShellScriptを使用するということになりました。  
 現段階(プログラマー2年目)で、C++の経験がほとんどないのでとりあえず勉強のために簡単なアプリを作成。  

## 環境
  今回は簡単に触りたかったのでwindowsでCloud9を利用してLinux環境が使えるようにしました  

## GitHub
  [今回作成したソース](https://github.com/erabu0619/cpp_dinner_pre)

## 学習のポイント
  * C++になれるためにとりあえず書いていく  
  * Makefileを使用してのビルド  
  * アプリの実行はShellScriptからできるようにする  

## アプリの簡単な設計
  * 食べたい食材、食べたくない食材の情報を参考にランダムで晩御飯を決定  
  * 決定した晩御飯は、CSVへログを保存  
  * CSV内で保存されているデータを集計表示  

## ディレクトリ構成
```
├─CsvApi
│  │  csvdate.csv          // 選択された情報のログ 
│  │  CsvType.hpp
│  │  main
│  │  main.cpp
│  │  Makefile
│  │
│  └─service
│          CsvService.cpp   // csvへの書き込み
│          CsvService.hpp
│
├─DinnerApi
│  │  DinnerDb.hpp
│  │  main
│  │  main.cpp
│  │  Makefile
│  │
│  └─service
│          MainService.cpp   // 晩御飯決定
│          MainService.hpp
├─main.sh                   // アプリ実行用ShellScript
```

## Makefileの作成
### CsvApi/Makefileの内容
  ネットで情報を集めつつ作成。  
  実行用のアプリは作成できたがオブジェクトファイルなどの記載については活用できず。  
  なぜ必要であるのかはあまり調査できていないので、今後学習が必要な点。  

```
### CsvApi/Makefile
# コンパイラ
CC = g++

# コンパイラオプション

# 実行ファイル
TARGET = main

# コンパイル対象のソースコード
SRCS = main.cpp ./service/CsvService.cpp

# オブジェクトファイル名
OBJS = $(SRCS:.cpp=.o)

# ターゲットファイル生成
$(TARGET): $(SRCS)
	$(CC) $^ -o $@ 
```
### 実行時のコマンド
  以下のコマンドを対象のディレクトリで実行することで、Makefileが実行されて実行ファイルが作成される  
```
$ make
```
  
## 晩御飯決定アプリ
  二つのディレクトリに分けて別々に作成。ソースコード詳細は、GitHubに公開。  
* CsvApi → Csv書きこみよう  
* DinnerApi → 晩御飯決定用  
  
## アプリ実行用 ShellScriptファイル
  1. DinnerApiを呼び出して、晩御飯を決定  
  2. 決定した晩御飯名をCsvApiへ渡して、CSVへ書き込み  
  3. ShellScirptでログ用のCSVを集計して、今までどのメニューが選択されてきたかを表示  

#### main.sh
```shell
# !/bin/sh

# 晩御飯決定処理
RESULT=$(./DinnerApi/main $1 $2)
echo "execution: ./DinnerApi/main" $1 $2

# OK or NG
RESULT_STATUS=`echo $RESULT | awk '{print substr($0, 0 ,2)}'`
# コンソール出力本文
RESULT_MAIN=`echo $RESULT | awk '{print substr($0, 4)}'`

if [ $RESULT_STATUS = "NG" ]; then
  echo $RESULT_MAIN
  exit 1
elif [ $RESULT_STATUS = "OK" ]; then
  echo "今日のご飯:"$RESULT_MAIN
  
  # csv書き込み処理
  RESULT_CSV=`./CsvApi/main $RESULT_MAIN`
  echo "execution: ./CsvApi/main" $RESULT_MAIN
  
  # OK or NG
  RESULT_CSV_STATUS=`echo $RESULT_CSV | awk '{print substr($0, 0 ,2)}'`
  # コンソール出力本文
  RESULT_CSV_MAIN=`echo $RESULT_CSV | awk '{print substr($0, 4)}'`
  
  echo $RESULT_CSV_MAIN
  
  if [ $RESULT_CSV_STATUS = "NG" ]; then
    exit 1
  fi
  
  # csvファイル集計
  echo ""
  echo "【晩御飯のトータル選択数】"
  
  cut -d, -f 2 ./CsvApi/csvdate.csv  \
  |  sed -e '1d' | sort | uniq -c   \
  | sed 's/. *//' | awk '{print $2 " : " $1 "回";}'
fi

exit 0
```

### 実行処理
  main.shを実行することで、以下一連の処理が行われる。  
```
# 実行処理
$ ./main.sh 食べたい トマト

# 以下は自動でコンソールへ表示される
$ ./DinnerApi/main 食べたい トマト
今日のご飯:ナポリタン

$ ./CsvApi/main ナポリタン
ファイルの書き込みに成功しました

【晩御飯のトータル選択数】
エビグラタン : 1回
エビフライ : 1回
オムレツ : 7回
カルボナーラ : 5回
チーズ牛丼 : 3回
トマトハンバーグ : 1回
ナポリタン : 10回
ハンバーグ : 7回
```

## 結果
  とりあえず思った通りの挙動を作成できたが、不明点だらけ。  
  次のプロジェクトも始まっていくので引き続き、学習は必要。  
  
## 難しかった点・今後の学習
  * 正しいディレクトリ構成がわからない  
  * Makefileの記載内容  
  * ビルド時の作成ファイル  
  * 環境変数や定数の書き方は?  
  * シェルスクリプトでのawkやワンライナーなど適切な記載方法  